<div class="container-fluid content-inner mt-n5 py-0">
    <div class="row">
        <div class="col-sm-12">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-12 col-md-12 col-lg-4 col-xl-4">
                            <div class="card card-hover mb-3" data-aos="fade-up" data-aos-delay="500">
                                <div class="card-body text-center p-0 bg-image ">
                                    <!-- Imagen de perfil -->
                                    <img src="<%= profileData.imagen ? `/uploads/${profileData.imagen}` : '/images/avatars/avatar-default.png' %>"
                                        alt="<%= profileData.nombre || 'Usuario' %>"
                                        class="av-border img-fluid rounded-circle mb-4 mt-3"
                                        style="object-fit: cover; width: 200px; height: 200px;">
                                </div>

                                <hr class="hr-horizontal mb-3">
                                <div class="card-body ms-4 pt-1 p-0 pb-1">
                                    <h5 class="h5 card-title mb-4">Nombre:
                                        <span id="nombreCompleto" class="fs-5 ms-2">
                                            <%= profileData.nombre || 'Nombre no disponible' %>
                                                <%= profileData.apellido_paterno || '' %>
                                                    <%= profileData.apellido_materno || '' %>
                                        </span>
                                    </h5>
                                </div>

                            </div>

                            <div class="card" data-aos="fade-up" data-aos-delay="500">
                                <div class="card-body">
                                    <div class="row">
                                        <ul class="list-group list-group-flush">
                                            <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                                                <h6 class="mb-0">
                                                    <i class="fas fa-user-tie me-2 icon-inline"></i>Cargo
                                                </h6>
                                                <span class="text-secondary">
                                                    <%= detalleLaboral.cargo || "No disponible" %>
                                                </span>
                                            </li>
                                            
                                            <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                                                <h6 class="mb-0">
                                                    <i class="fas fa-school me-2 icon-inline"></i>Tipo Org.
                                                </h6>
                                                <span class="text-secondary">
                                                    <%= detalleLaboral.tipo_organizacion || "No disponible" %>
                                                </span>
                                            </li>
                                            
                                            <li
                                                class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                                                <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24"
                                                        height="24" viewBox="0 0 24 24" fill="none"
                                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        class="feather feather-globe me-2 icon-inline">
                                                        <circle cx="12" cy="12" r="10"></circle>
                                                        <line x1="2" y1="12" x2="22" y2="12"></line>
                                                        <path
                                                            d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
                                                        </path>
                                                    </svg>Sector</h6>
                                                <span class="text-secondary">
                                                    <%= detalleLaboral.sector || "No disponible" %>
                                                </span>
                                            </li>
                                            <li
                                                class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                                                <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24"
                                                        height="24" viewBox="0 0 24 24" fill="none"
                                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        class="feather feather-github me-2 icon-inline">
                                                        <path
                                                            d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
                                                        </path>
                                                    </svg>Zona</h6>
                                                <span class="text-secondary">
                                                    <%= detalleLaboral.zona || "No disponible" %>
                                                </span>
                                            </li>
                                            <li
                                                class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                                                <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24"
                                                        height="24" viewBox="0 0 24 24" fill="none"
                                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        class="feather feather-twitter me-2 icon-inline text-info">
                                                        <path
                                                            d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z">
                                                        </path>
                                                    </svg>Municipio</h6>
                                                <span class="text-secondary">
                                                    <%= detalleLaboral.municipio || "No disponible" %>
                                                </span>
                                            </li>
                                            <li
                                                class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                                                <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24"
                                                        height="24" viewBox="0 0 24 24" fill="none"
                                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        class="feather feather-instagram me-2 icon-inline text-danger">
                                                        <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                                                        <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z">
                                                        </path>
                                                        <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                                                    </svg>Comunidad</h6>
                                                <span class="text-secondary">
                                                    <%= detalleLaboral.comunidad || "No disponible" %>
                                                </span>
                                            </li>
                                            <li
                                                class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                                                <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24"
                                                        height="24" viewBox="0 0 24 24" fill="none"
                                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        class="feather feather-facebook me-2 icon-inline text-primary">
                                                        <path
                                                            d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z">
                                                        </path>
                                                    </svg>Clave CCT</h6>
                                                <span class="text-secondary">
                                                    <%= detalleLaboral.clave_cct || "No disponible" %>
                                                </span>
                                            </li>
                                            <li
                                                class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                                                <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24"
                                                        height="24" viewBox="0 0 24 24" fill="none"
                                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        class="feather feather-facebook me-2 icon-inline text-primary">
                                                        <path
                                                            d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z">
                                                        </path>
                                                    </svg>Z.E</h6>
                                                <span class="text-secondary">
                                                    <%= detalleLaboral.z_e || "No disponible" %>
                                                </span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                            <!-- Datos-->
                        <div class="col-md-12 col-lg-8 col-xl-8">
                            <div class="card mb-3" data-aos="fade-up" data-aos-delay="600">
                                <div class="card-body">
                                    <!-- Dirección -->
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">Dirección</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <%= profileData.direccion || 'No disponible' %>
                                        </div>
                                    </div>
                                    <hr class="mb-2" style="border-top: 1px solid #828282;">

                                    <!-- Teléfono -->
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">Teléfono</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <%= profileData.telefono || 'No disponible' %>
                                        </div>
                                    </div>
                                    <hr class="mb-2" style="border-top: 1px solid #828282;">

                                    <!-- Correo -->
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">Correo</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <%= profileData.correo || 'No disponible' %>
                                        </div>
                                    </div>
                                    <hr class="mb-2" style="border-top: 1px solid #828282;">

                                    <!-- RFC -->
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">RFC</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <%= profileData.rfc || 'No disponible' %>
                                        </div>
                                    </div>
                                    <hr class="mb-2" style="border-top: 1px solid #828282;">

                                    <!-- CURP -->
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">CURP</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <%= profileData.curp || 'No disponible' %>
                                        </div>
                                    </div>
                                    <hr class="mb-2" style="border-top: 1px solid #828282;">

                                    <!-- Fecha de nacimiento -->
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">Fecha de Nacimiento</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <%= profileData.fecha_nacimiento ? new Intl.DateTimeFormat('es-MX', {
                                                dateStyle: 'long' }).format(new Date(profileData.fecha_nacimiento))
                                                : 'No disponible' %>
                                        </div>
                                    </div>
                                    <hr class="mb-2" style="border-top: 1px solid #828282;">

                                    <!-- Edad -->
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">Edad</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <%= profileData.edad || 'No disponible' %>
                                        </div>
                                    </div>
                                    <hr class="mb-2" style="border-top: 1px solid #828282;">

                                    <!-- Laboral -->
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">Fecha de ingreso</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <%= detalleLaboral.fecha_ingreso ? new Intl.DateTimeFormat('es-MX', {
                                                dateStyle: 'long' }).format(new Date(detalleLaboral.fecha_ingreso))
                                                : 'No disponible' %>
                                        </div>
                                    </div>
                                    <hr class="mb-2" style="border-top: 1px solid #828282;">
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">Fecha de nombramiento</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <%= detalleLaboral.fecha_nombramiento ? new Intl.DateTimeFormat('es-MX', {
                                                dateStyle: 'long' }).format(new Date(detalleLaboral.fecha_nombramiento))
                                                : 'No disponible' %>
                                        </div>
                                    </div>
                                    <hr class="mb-2" style="border-top: 1px solid #828282;">
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">Antiguedad</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <%= detalleLaboral.antiguedad_compacta || 'No disponible' %>
                                        </div>
                                    </div>
                                    <hr class="mb-2" style="border-top: 1px solid #828282;">

                                    <!-- Correo -->
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">Nivel de Gobierno</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <%= detalleLaboral.tipo_entidad || 'No disponible' %>
                                        </div>
                                    </div>
                                    <hr class="mb-2" style="border-top: 1px solid #828282;">

                                    <!-- RFC -->
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">Tipo de Dirección</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <%= detalleLaboral.tipo_direccion || 'No aplica' %>
                                        </div>
                                    </div>
                                    <hr class="mb-2" style="border-top: 1px solid #828282;">

                                    <!-- CURP -->
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">Nombramiento</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <%= detalleLaboral.nombramiento || 'No disponible' %>
                                        </div>
                                    </div>
                                    <hr class="mb-2" style="border-top: 1px solid #828282;">

                                    <!-- Fecha de nacimiento -->
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">Grado</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <%= detalleLaboral.grado|| 'No disponible' %>
                                        </div>
                                    </div>
                                    <hr class="mb-2" style="border-top: 1px solid #828282;">


                                    <!-- Botón Editar -->
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <!-- Botón que activa el modal -->
                                            <a href="#" class="btn btn-primary" data-bs-toggle="modal"
                                                data-bs-target="#editarPersonalModal">Editar</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>



                    <div class="col-12">
                        <div class="card mb-3" data-aos="fade-up" data-aos-delay="600">
                            <div class="card-body" style="height: auto; overflow-y: auto; padding-bottom: 3rem;">
                                <!-- Título principal -->
                                <div class="row bg-primary mb-4">
                                    <h1 class="text-white text-center py-2">Procesos en Tránsito</h1>
                                </div>
                                <div class="row mx-0">
                                    <%- include('partials/perfiles-personal/procesos-tabla-personal') %>
                                </div>
                            </div>
                        </div>
                    </div>


        
                    <div class="col-12">
                        <div class="card mb-3" data-aos="fade-up" data-aos-delay="600">
                            <div class="card-body" style="height: 700px; overflow-y: auto; padding-bottom: 3rem;">
                                <div class="mb-3">
                                    <label class="fw-bold">Filtrar por Fecha:</label>
                                    <input type="text" id="dateRangePicker" class="form-control" placeholder="Selecciona rango de fechas">
                                </div>
                                <!-- Título principal -->
                                <div class="row bg-primary">
                                    <h1 class="text-white text-center py-2">Historial</h1>
                                </div>
                    
                                <% Object.keys(historiales).forEach(historialTipo => { %>
                                    <% let historial = historiales[historialTipo] || []; %>
                                    <% if (historial.length > 0) { %>

                                        <!-- Título del historial -->

                                        <!-- Iteración de datos del historial -->
                                        <% historial.forEach(dato => { %>
                                            <div class="tracking-item border-bottom pb-3 mb-3">
                                                
                                                <!-- Icono y Fecha -->
                                                <div class="d-flex align-items-center justify-content-between mb-2">
                                                    <div class="tracking-icon status-intransit me-2">
                                                        <svg class="svg-inline--fa fa-circle fa-w-16" aria-hidden="true" viewBox="0 0 512 512">
                                                            <path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path>
                                                        </svg>
                                                    </div>

                                                    <div class="tracking-date">
                                                        <%= dato.fecha ? new Date(dato.fecha).toLocaleDateString('es-MX', { year: 'numeric', month: '2-digit', day: '2-digit' }) : "Sin fecha" %>
                                                        <span class="text-muted">
                                                            <%= dato.fecha_cambio ? new Date(dato.fecha_cambio).toLocaleTimeString('es-MX') : "" %>
                                                        </span>
                                                    </div>
                                                    <div class="d-flex align-items-center justify-content-between mb-2">
                                                        <!-- Nombre de la Tabla con Badge -->
                                                        <div class="badge bg-primary text-wrap mb-2">
                                                            <%= historialTipo %>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Estatus Condicionales -->
                                                <% let estatusClas = ""; %>
                                                <% if (dato.estatus === "Atendido") { %>
                                                    <% estatusClas = "text-success"; %>
                                                <% } else if (dato.estatus === "En Proceso") { %>
                                                    <% estatusClas = "text-warning"; %>
                                                <% } else if (dato.estatus === "Entregado A Setel") { %>
                                                    <% estatusClas = "text-primary"; %>
                                                <% } else if (dato.estatus === "Sin atender") { %>
                                                    <% estatusClas = "text-danger"; %>
                                                <% } else { %>
                                                    <% estatusClas = "text-secondary"; %>
                                                <% } %>
                                                
                                                <!-- Estatus -->
                                                <% if (historialTipo !== "Becas" && historialTipo !== "Licencia sin goce") { %>
                                                    <div class="row mb-2">
                                                        <div class="col-sm-3 fw-bold">Estatus:</div>
                                                        <div class="col-sm-9 text-secondary">
                                                            <span class="<%= estatusClas %>">
                                                                <%= dato.estatus || "Estatus no especificado" %>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <hr class="mb-2" style="border-top: 1px solid #828282;">
                                                <% } %>
                                                
                                                
                                                <!-- Docentes Disponibles, Solicitudes de cambio y Salud -->
                                                <% if (historialTipo === "Docentes disponibles" || historialTipo === "Solicitudes de Cambio" || historialTipo === "Salud e Inseguridad") { %>
                                                    <%- include('partials/docente-cambio-h', { dato: dato, historialTipo: historialTipo }) %>
                                                <% } %>

                                                <!-- Solicitudes Generales -->
                                                <% if (historialTipo === "Solicitudes Generales") { %>
                                                    <%- include('partials/h-solicitudesGral', { dato: dato, historialTipo: historialTipo }) %>
                                                <% } %>
                                                <!-- Becas -->
                                                <% if (historialTipo === "Becas") { %>
                                                    <%- include('partials/h-becas', { dato: dato, historialTipo: historialTipo }) %>
                                                <% } %>

                                                <% if (historialTipo === "Licencia sin goce") { %>
                                                    <%- include('partials/h-licencias-goce', { dato: dato, historialTipo: historialTipo }) %>
                                                <% } %>

                                                <% if (historialTipo === "Incidencias") { %>
                                                    <%- include('partials/h-incidencias', { dato: dato, historialTipo: historialTipo }) %>
                                                <% } %>
                                            
                                                
                                                <!-- Observaciones -->
                                                <div class="mt-3">
                                                    <h6 class="badge bg-primary fs-6">Observaciones</h6>
                                                    <p class="mb-0"><%= dato.observaciones || "Sin observaciones" %></p>
                                                </div>

                                                
                                                
                                                    
                                            </div>
                                        <% }) %>
                                    <% } %>
                                <% }) %>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</div>
</div>


<!-- Modal -->
<div class="modal fade" id="editarPersonalModal" tabindex="-1" aria-labelledby="editarPersonalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg ">
        <div class="modal-content">
            <%- include('partials/editar-perfil.ejs') %>
        </div>
    </div>
</div>

<script>
    // Selecciona el elemento del span por su ID
    const nombreCompleto = document.getElementById("nombreCompleto");

    // Aplica la transformación de texto
    if (nombreCompleto) {
        nombreCompleto.textContent = nombreCompleto.textContent
            .toLowerCase() // Convierte todo a minúsculas
            .replace(/\b\w/g, (char) => char.toUpperCase()); // Capitaliza la primera letra de cada palabra
    }
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const trackingItems = document.querySelectorAll(".tracking-item");

        flatpickr("#dateRangePicker", {
            mode: "range",
            dateFormat: "Y-m-d",
            locale: "es",
            onClose: function (selectedDates) {
                const [startDate, endDate] = selectedDates;

                trackingItems.forEach(item => {
                    const dateElement = item.querySelector(".tracking-date");
                    const itemDate = new Date(dateElement.textContent.trim().split(' ')[0].split('/').reverse().join('-'));

                    if ((!startDate || itemDate >= startDate) && (!endDate || itemDate <= endDate)) {
                        item.style.display = "";
                    } else {
                        item.style.display = "none";
                    }
                });
            }
        });
    });
</script>

